<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD Application</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;

            height: 200vh;
            margin: 0;
            font-family: Arial, sans-serif;
        }

        h1,
        h2 {
            text-align: center;
        }

        form {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        input {
            padding: 10px;
            width: 200px;
        }

        button {
            padding: 10px 20px;
            margin: 5px;

        }

        table,
        th,
        td {
            border: 1px solid black;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 10px;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>CRUD Application</h1>

        <h2>Create Cow</h2>
        <form id="create-form">
            <input type="text" name="nama" placeholder="Name" required>
            <input type="text" name="id_rfid" placeholder="RFID" required>
            <input type="date" name="tanggal_lahir" placeholder="Date of Birth" required>
            <input type="text" name="jenis_kelamin" placeholder="Gender" required>
            <input type="number" name="berat" placeholder="Weight" required>
            <input type="number" name="harga" placeholder="Price" required>
            <button type="submit">Create</button>
        </form>

        <h2>All Cows</h2>
        <table>
            <thead>
                <tr>
                    <th>UID</th>
                    <th>RFID</th>
                    <th>Name</th>
                    <th>Date of Birth</th>
                    <th>Gender</th>
                    <th>Weight</th>
                    <th>Price</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="cow-table-body">
            </tbody>
        </table>

        <br>
        <br>
        <br>

        <h2>Cow By ID</h2>
        <form id="get-form">
            <input type="text" name="id" placeholder="Cow ID" required>
            <button type="submit">Get Cow</button>
        </form>
        <div id="cow-detail"></div>

        <br>
        <br>
        <br>

        <h2>Edit Cow</h2>
        <form id="edit-form">
            <input type="text" name="id" placeholder="Cow ID" required>
            <input type="text" name="nama" placeholder="Nama">
            <input type="text" name="id_rfid" placeholder="RFID">
            <input type="date" name="tanggal_lahir" placeholder="Date of Birth">
            <input type="text" name="jenis_kelamin" placeholder="Gender">
            <input type="number" name="berat" placeholder="Weight">
            <input type="number" name="harga" placeholder="Price">
            <button type="submit">Edit</button>
        </form>
        <!-- 
        <h2>Delete Cow</h2>
        <form id="delete-form">
            <input type="text" name="id" placeholder="Cow ID" required>
            <button type="submit">Delete</button>
        </form> -->
    </div>

    <script>
        const apiUrl = 'https://6b966g89-5001.asse.devtunnels.ms/sapi';

        document.getElementById('create-form').addEventListener('submit', async function (event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            const result = await response.json();
            alert(result.message);
            fetchCows();
        });

        function fetchCows() {
            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    const cowTableBody = document.getElementById('cow-table-body');
                    cowTableBody.innerHTML = '';

                    data.forEach(cow => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${cow.uid}</td>
                            <td>${cow.id_rfid}</td>
                            <td>${cow.nama}</td>
                            <td>${cow.tanggal_lahir}</td>
                            <td>${cow.jenis_kelamin}</td>
                            <td>${cow.berat}</td>
                            <td>${cow.harga}</td>
                            <td>${cow.status ? 'Active' : 'Inactive'}</td>
                            <td>
                                <button onclick="editCow('${cow.uid}')">Edit</button>
                                <button onclick="deleteCow('${cow.uid}')">Delete</button>
                            </td>
                        `;
                        cowTableBody.appendChild(row);
                    });
                })
                .catch(error => console.error('Error fetching data:', error));
        }

        document.getElementById('get-form').addEventListener('submit', async function (event) {
            event.preventDefault();
            const id = new FormData(event.target).get('id');

            const response = await fetch(`${apiUrl}/${id}`);
            const cow = await response.json();
            document.getElementById('cow-detail').textContent = JSON.stringify(cow);
        });

        function editCow(uid) {
            const newName = prompt('Enter new name:');
            const newIdRfid = prompt('Enter new RFID:');
            const newTanggalLahir = prompt('Enter new Date of Birth (YYYY-MM-DD):');
            const newJenisKelamin = prompt('Enter new Gender:');
            const newBerat = prompt('Enter new Weight:');
            const newHarga = prompt('Enter new Price:');
            const newStatus = confirm('Is the cow active?');

            const data = {
                nama: newName,
                id_rfid: newIdRfid,
                tanggal_lahir: newTanggalLahir,
                jenis_kelamin: newJenisKelamin,
                berat: newBerat,
                harga: newHarga,
                status: newStatus
            };

            fetch(`${apiUrl}/${uid}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(result => {
                    console.log('Edit Success:', result);
                    fetchCows();
                })
                .catch(error => console.error('Error:', error));
        }

        function deleteCow(uid) {
            fetch(`${apiUrl}/${uid}`, {
                method: 'DELETE'
            })
                .then(response => response.json())
                .then(result => {
                    console.log('Delete Success:', result);
                    fetchCows();
                })
                .catch(error => console.error('Error:', error));
        }

        fetchCows();
    </script>
</body>

</html>